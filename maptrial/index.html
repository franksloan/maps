<!DOCTYPE html>
<meta charset="utf-8">


	<style>
		div.tooltip {
		  position: absolute;
		  padding: 8px;
		  font: 12px sans-serif;
		  background: #fff;
		  border: solid 1px #aaa;
		  border-radius: 8px;
		  pointer-events: none;
		}

		#map {
			max-height: 650px;
			display: inline-block;
			margin: 0 auto;
			border-width: 1.5px;
			border-color: #333;
			border-style: solid;
			overflow: hidden;
			max-width: 900px;
		}
		.country {
		  fill: #ccc;
		  stroke: #fff;
		  stroke-width: 0.5px;
		  stroke-linejoin: round;
		}
		.overlay {
		  fill: none;
		  stroke: #000;
		  stroke-width: .5px;
		}
		button {
			padding: 10px;
		}
	</style>
	<title>Interactive maps</title>
	<body>
		<div id="map">
			<button id="zoomin">
				+
			</button>
			<button id="zoomout">
				-
			</button>
		</div>
  	<script src="http://d3js.org/d3.v3.min.js"></script>
  	
	<script src="http://d3js.org/topojson.v1.min.js"></script>
	<script>
		//dimensions of view port
		var width = 1000,
    		height = 700;

    	var projection = d3.geo.mercator()
	    	.translate([width/2, height/2])
	    	.scale((width - 1) / 2 / Math.PI);
			
		var zoom = d3.behavior.zoom()
			.scaleExtent([1,8])
			.on("zoom", zoomed);

		var path = d3.geo.path()
    		.projection(projection);

    	function worldMap(){
    		var map = {};

    		map.render = function(){
    			var svg = d3.select("#map").append("svg")
		    		.attr("width", width)
		    		.attr("height", height)
					.append("g");
					
		    	var g = svg.append("g");
    		}

    		return map;
    	}

    	worldMap();

    	//add viewport rectangle as overlay
    	svg.append("rect")
    		.attr("class", "overlay")
    		.attr("width", width)
    		.attr("height", height);
    				
    	svg.call(zoom)
    		.call(zoom.event);
		
		//zoom or pan on map
		function zoomed() {
			var tra = zoom.translate(),
				sca = zoom.scale();
			
			g.attr("transform", 
				"translate("+tra+") " +
				"scale("+sca+")"
				);			
		}

		//create tooltip which can be seen when hovering over country
		var tooltip = d3.select("body").append("div")
		  	  .attr("class", "tooltip")
		  	  .style("opacity", 1e-6)
		  	  .style("background", "rgba(250,250,250,.7)");
		
		d3.selectAll("button").on('click', zoomClick);


		function makeZoom(translate, scale){
			var self = this;
			return d3.transition().tween("zoom", function () {
			        var iTranslate = d3.interpolate(zoom.translate(), translate),
			            iScale = d3.interpolate(zoom.scale(), scale);
			        return function (t) {
			            zoom.scale(iScale(t))
			                .translate(iTranslate(t));
			            zoomed();
			        };
			    });
		}
		
		function zoomClick(){
			var dir = 1,
				factor = 0.25,
				extent = zoom.scaleExtent(),
				translate = zoom.translate(),
				translate0 = [],
				target_zoom = 1,
				center = [width / 2, height /2],
				l = [],
				//object to hold positions
				view = {x: translate[0], y: translate[1], k: zoom.scale()};

			d3.event.preventDefault();
			//zoom in or out
			dir = (this.id === 'zoomin') ? 1 : -1;
			//new zoom
			target_zoom = zoom.scale() * (1 + factor * dir);

			//only allow zooming in so far
			if (target_zoom < extent[0] || target_zoom > extent[1]){
				return false;
			}

			translate0 = [(center[0] - view.x)/ view.k, (center[1] - view.y)/ view.k];
			view.k = target_zoom;
			l = [translate0[0] * view.k + view.x, translate0[1] * view.k + view.y];

		    view.x += center[0] - l[0];
		    view.y += center[1] - l[1];
		    //send in the current pan and zoom
		    makeZoom([view.x, view.y], view.k);
		}

		tooltip.append("span").attr("id", "countryName");
		
		//get data to display the map
		d3.json("world.json", function(error, world) {
  			if (error) return console.error(error);
  			var countries = topojson.feature(world, world.objects.countries).features;

			g.selectAll("path")
			.attr("d", path);
  			
			g.selectAll(".country")
		      .data(countries)
			  .enter().append("path")
		      .attr("class", "country")
		      .attr("id", function(j){
		      	return j.id;
		      })
		      .attr("d", path)
			  .on("mouseover", function(d){
				d3.select(this).style("fill", "#3cc");
				tooltip.style("left", (d3.event.pageX + 5) + "px")
				    .style("top", (d3.event.pageY - 5) + "px")
				    .transition().duration(300)
				    .style("opacity", 1)
				    .style("display", "block")
				    .text(this.id);
			  })
			  //if moving out of a country and not into another
			  //don't want to see the tooltip
			  .on("mouseout", function(d){
				d3.select(this).style("fill", "#ccc");
				tooltip.style("display", "none");
			  });
  				
		});
	</script>
	
</body>